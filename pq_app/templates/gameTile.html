{% extends "base.html" %}

{% block title %}PyQuest Game{% endblock %}

{% block content %}
    <h1>PyQuest Game</h1>
    <h2>Tile # {{form.tileid}}</h2>
    <form id="tile-form" action="/player/{{player_char.id}}/game/tile/next" method="post">
        {{ form.csrf_token }}
        <div>{{ form.type.label }}: {{ form.type }}</div>
        <div>{{ form.content.label }}: {{ form.content }}</div>
        <div>{{ form.action.label }}: {{ form.action }}</div>

        <button id="take-action" type="submit" formaction="/player/{{player_char.id}}/game/tile/{{ form.tileid.data if form.tileid else form.tileid }}/action">Take Action</button>
        <input type="submit" value="Proceed to Next Tile">
    </form>

    {% if action_result %}
        {% include "_action_result.html" %}
    {% endif %}

    <script>
    (function(){
        var form = document.getElementById('tile-form');
        var takeBtn = document.getElementById('take-action');
        if (!form || !takeBtn) return;
        takeBtn.addEventListener('click', function(e){
            var select = form.querySelector('select[name="action"]');
            if (!select) return;
            var val = select.value;
            if (val === 'quit') {
                if (!confirm('Are you sure you want to quit this adventure?')) {
                    e.preventDefault();
                }
            }
        }, false);
    })();
    </script>
    {% endblock %}